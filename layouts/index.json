{{- $images := slice -}}
{{- range .Site.AllPages -}}
  {{- $context := . -}}
  {{- $params := .Params | merge $.Site.Params.Page -}}
  {{- range .Resources.ByType "image" -}}
    {{- $lores := .Resize (site.Params.loResOpt | default "700x webp Lanczos q60") -}}
    {{- $hires := .Resize (site.Params.hiResOpt | default "2000x webp Lanczos q75") -}}
    {{- $images = $images | append (dict
      "alt" (string .Name)
      "loUrl" (string $lores.RelPermalink)
      "loImgH" (int $lores.Height)
      "loImgW" (int $lores.Width)
      "hiUrl" (string $hires.RelPermalink)
      "hiImgH" (int $hires.Height)
      "hiImgW" (int $hires.Width)
    ) -}}
  {{- end -}}
{{- end -}}

{{- /* Aggiungiamo l'indice dopo aver raccolto tutto */ -}}
{{- $finalImages := slice -}}
{{- range $index, $img := $images -}}
  {{- $finalImages = $finalImages | append (merge $img (dict "index" $index)) -}}
{{- end -}}

{{ $finalImages | jsonify }}
